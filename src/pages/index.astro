---
import BaseLayout from '../layouts/BaseLayout.astro';
import PointCloudViewer from '../components/PointCloudViewer.tsx';
---

<BaseLayout title="Ethan Kong">
  <!-- Animated topographic background canvas -->
  <canvas id="bg-canvas" class="bg-canvas"></canvas>

  <main class="landing">
    <!-- Left: 3D Viewer -->
    <section class="landing-viewer">
      <PointCloudViewer src="/assets/3dImage.lssnap" client:only="react" />
    </section>

    <!-- Right: Bio Card -->
    <section class="landing-bio">
      <div class="bio-card glass-card" id="bio-card">
        <p class="bio-greeting">
          hi i'm <span class="gradient-text">ETHAN KONG</span>
        </p>

        <p class="bio-text">
          I was born and raised in Hong Kong and am now studying Aeronautics
          and Astronautics at UC Berkeley. I love to make cool and fun projects,
          which you can take a look at here. I hope you enjoy exploring my
          projects as much as I enjoyed working on them.
        </p>
        <p class="bio-text">
          I'm currently working with the Plasma Physics Lab and am part of the
          Solar Car Project, Stanford Student Robotics, and Stanford Space
          Initiative. Outside of my studies, I enjoy sailing and throwing
          pottery on the wheel.
        </p>

        <p class="bio-contact-label">Feel free to reach out:</p>

        <div class="bio-contacts">
          <a href="mailto:ethank07@stanford.edu" class="contact-icon" aria-label="Email">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <rect x="2" y="4" width="20" height="16" rx="2"/>
              <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
            </svg>
          </a>
          <a href="https://github.com/DoggoOP" target="_blank" class="contact-icon" aria-label="GitHub">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0 1 12 6.844a9.59 9.59 0 0 1 2.504.337c1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.02 10.02 0 0 0 22 12.017C22 6.484 17.522 2 12 2z"/>
            </svg>
          </a>
          <a href="https://www.linkedin.com/in/ethank07/" target="_blank" class="contact-icon" aria-label="LinkedIn">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
          <a href="/assets/resume.pdf" download class="contact-icon" aria-label="Resume">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="12" y1="18" x2="12" y2="12"/>
              <polyline points="9,15 12,18 15,15"/>
            </svg>
          </a>
        </div>

        <button data-open-projects class="bio-projects-link">
          View Projects
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </section>
  </main>
</BaseLayout>

<style>
  /* Full-viewport canvas background */
  .bg-canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
    width: 100%;
    height: 100%;
  }

  .landing {
    position: relative;
    z-index: 1;
    display: flex;
    height: 100vh;
    padding-top: 56px;
  }

  .landing-viewer {
    flex: 0 0 58%;
    height: 100%;
    position: relative;
  }

  .landing-bio {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px 48px 40px 24px;
  }

  .bio-card {
    width: 100%;
    max-width: 440px;
    padding: 36px 40px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    /* 3D tilt uses JS — needs perspective on parent */
    transform-style: preserve-3d;
    transition: transform 0.12s ease-out, box-shadow 0.12s ease-out;
    will-change: transform;
  }

  .bio-card:hover {
    box-shadow: 0 24px 60px rgba(0, 212, 255, 0.12), 0 8px 24px rgba(0,0,0,0.4);
  }

  .bio-greeting {
    font-size: 28px;
    font-weight: 800;
    line-height: 1.2;
    letter-spacing: -0.02em;
  }

  .bio-text {
    font-size: 14px;
    line-height: 1.7;
    color: var(--text-secondary);
  }

  .bio-contact-label {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  .bio-contacts {
    display: flex;
    gap: 20px;
    align-items: center;
  }

  .contact-icon {
    color: var(--text-secondary);
    transition: color 0.2s, transform 0.2s;
  }
  .contact-icon:hover {
    color: var(--accent-cyan);
    transform: translateY(-2px);
  }

  .bio-projects-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    padding: 10px 22px;
    background: linear-gradient(135deg, rgba(0,212,255,0.12), rgba(123,47,247,0.12));
    border: 1px solid var(--border-accent);
    border-radius: var(--radius-btn);
    font-size: 14px;
    font-weight: 600;
    color: var(--accent-cyan);
    align-self: flex-start;
    cursor: pointer;
    font-family: inherit;
    transition: background 0.2s, transform 0.2s;
  }
  .bio-projects-link:hover {
    background: linear-gradient(135deg, rgba(0,212,255,0.2), rgba(123,47,247,0.2));
    transform: translateX(2px);
  }
</style>

<script>
  // ─── Animated topographic background ───────────────────────────────────────
  (function initBg() {
    const canvas = document.getElementById('bg-canvas') as HTMLCanvasElement | null;
    if (!canvas) return;

    const ctx = canvas.getContext('2d')!;

    // Offscreen low-res canvas for perf
    const OW = 320, OH = 180;
    const off = document.createElement('canvas');
    off.width = OW; off.height = OH;
    const offCtx = off.getContext('2d')!;
    const imgData = offCtx.createImageData(OW, OH);
    const pix = imgData.data;

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    let t = 0;

    // Large blobs: bx/by are center fractions, vx/vy are drift frequencies
    const blobs = [
      { bx: 0.20, by: 0.32, vx: 0.38, vy: 0.27, r: 0.60, phase: 0.00, cr: 0,   cg: 210, cb: 255 },
      { bx: 0.80, by: 0.68, vx: 0.27, vy: 0.43, r: 0.52, phase: 2.09, cr: 130, cg: 0,   cb: 240 },
      { bx: 0.50, by: 0.82, vx: 0.21, vy: 0.34, r: 0.44, phase: 4.19, cr: 0,   cg: 220, cb: 160 },
    ];

    function render() {
      t += 0.004;

      const bpos = blobs.map(b => ({
        x: (b.bx + Math.sin(t * b.vx + b.phase) * 0.13) * OW,
        y: (b.by + Math.cos(t * b.vy + b.phase * 0.9) * 0.10) * OH,
        r: b.r * Math.min(OW, OH),
        cr: b.cr, cg: b.cg, cb: b.cb,
      }));

      for (let py = 0; py < OH; py++) {
        for (let px = 0; px < OW; px++) {
          let r = 4, g = 4, b = 12;

          for (const blob of bpos) {
            const dx = px - blob.x;
            const dy = py - blob.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            const norm = dist / blob.r;
            if (norm >= 1.7) continue;

            // Topographic banding: alternate dark/light rings
            const numBands = 13;
            const band = Math.floor(norm * numBands);
            const isDark = band % 2 === 0;

            const intensity = Math.pow(Math.max(0, 1 - norm * 0.65), 1.2) * (isDark ? 0.25 : 1.0);

            r = Math.max(r, blob.cr * intensity);
            g = Math.max(g, blob.cg * intensity);
            b = Math.max(b, blob.cb * intensity);
          }

          const i = (py * OW + px) * 4;
          pix[i]   = r | 0;
          pix[i+1] = g | 0;
          pix[i+2] = b | 0;
          pix[i+3] = 255;
        }
      }

      offCtx.putImageData(imgData, 0, 0);

      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(off, 0, 0, canvas.width, canvas.height);

      requestAnimationFrame(render);
    }

    render();
  })();

  // ─── Bio card 3D tilt on hover ─────────────────────────────────────────────
  (function initCardTilt() {
    const card = document.getElementById('bio-card') as HTMLElement | null;
    if (!card) return;

    card.addEventListener('mousemove', (e: MouseEvent) => {
      const rect = card.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width  - 0.5) * 2;
      const y = ((e.clientY - rect.top)  / rect.height - 0.5) * 2;
      card.style.transform = `perspective(900px) rotateY(${x * 9}deg) rotateX(${-y * 7}deg) scale(1.02)`;
    });

    card.addEventListener('mouseleave', () => {
      card.style.transform = 'perspective(900px) rotateY(0deg) rotateX(0deg) scale(1)';
    });
  })();
</script>
